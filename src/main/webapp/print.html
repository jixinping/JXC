<html xmlns:th="http://www.w3.org/1999/xhtml">

<head><meta charset="UTF-8"></head>
<body>
<script type="text/javascript" src="/static/jquery-easyui-1.3.3/jquery.min.js"></script>
<script type="text/javascript" src="/static/jquery-easyui-1.3.3/jquery.jqprint-0.3.js"></script>
<script src="http://www.jq22.com/jquery/jquery-migrate-1.2.1.min.js"></script>
<script th:inline="javascript">
	$(function() {
		var selectedRows = parent.$('#dg').datagrid("getSelections");
		getData(selectedRows[0]);
	})
	
	function getData(row) {
		var saleNumber=row.saleNumber;
		var type=parent.$('#tatleType').val();
		var url="/print/"+type;
		$.post(url,{saleNumber:saleNumber},function(result){
			var company=result.company;
			var dataRows=result.rows;
			initData(row, company);
			initTable(dataRows);
		 });
	}
	
	function initData(row, company) {
		var id=row.id;
		var saleNumber=row.saleNumber;
		var saleDate=row.saleDate;
		var customer=row.customer.name;
		var amountPayable='总金额:'+row.amountPayable+'元';
		var user=row.user.trueName;
		var remarks=row.remarks;
		$("#tatle").text(company);
		$("#idNo").text(id);
		$("#saleNumber").text('订单号:'+saleNumber); 
		$("#printDirect").text(parent.$('#printDirect').val()); 
		$("#tatleType").html(parent.$('#tatleType').val()); 
		$("#saleDate").text('日期:'+saleDate); 
		$("#customer").text('客户:'+customer); 
		$("#totleAmount").text(amountPayable); 
		$("#userName").text('操作员:'+user); 
		$("#remarks").text('备注:'+remarks); 
	}
	
	function initTable(rows) {
		var html="<tr>"+
            "<th style='width: 30%'>商品名</th>"+
            "<th>商品型号</th>"+
            "<th>单价</th>"+
            "<th>数量</th>"+
            "<th>单位</th>"+
            "<th>小计金额</th>"+
        	"</tr>";
       	for(var i=0;i<rows.length;i++) {
       		var rowData = rows[i];
       		html += "<tr>"+
               "<td>"+rowData.name+"</td>"+
               "<td>"+rowData.model+"</td>"+
               "<td>"+rowData.price+"元</td>"+
               "<td>"+rowData.num+"</td>"+
               "<td>"+rowData.unit+"</td>"+
               "<td>"+rowData.total+"元</td>";
       	}
       	$("#dataTable").html(html);
       	
       	printJudge();
	}
	
	function printJudge() {
		var isDrect = parent.$("#printDirect").val();
	    if(0 == isDrect) {
	    	window.onclick = function(event) {
				parent.$('#printDiv').hide();
		    }
	    }
	    
	    if(1 == isDrect) {
	        $("#allTable").jqprint();
	    }
	}

</script>
<div id=allTable style="width: 100%">
    <h3 id="tatle" style="text-align: center"></h3>
    <div style="width: 80%;margin-left: auto;margin-right: auto">
        <div style="width:100%">
            <p  style="width:100%">
                <span id="saleNumber"></span>
                <span id="saleDate" style="padding-left: 3%"></span>
                <span id="userName" style="padding-left: 3%"></span>
            </p>
            <p>
                <span id="customer"></span>
                <span id="totleAmount" style="padding-left: 8%"></span>
            </p>
            <p>
                <span id="remarks"></span>
            </p>
        </div>
    </div>
    <div style="text-align: center">
        <table id="dataTable" style="width: 80%;margin-left: auto;margin-right: auto" border="1">
        </table>
    </div>
</div>
</body>

</html>